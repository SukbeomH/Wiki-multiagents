# 마이그레이션 요약 및 계획

## 개요

이 문서는 기존 프로젝트 구조에서 새로운 `src/` 기반 구조로의 마이그레이션 요약과 실행 계획을 제공합니다.

## 현재 상태 분석

### ✅ 완료된 작업
- **디렉토리 구조 설계**: 새로운 `src/` 기반 구조 설계 완료
- **신규 디렉토리 생성**: 모든 새로운 디렉토리 및 `__init__.py` 파일 생성 완료
- **Research Agent 모듈화**: 이미 완료된 Research Agent는 새로운 구조에 맞게 조정 필요

### 📊 파일 분포 현황

#### 현재 파일 분포
```
server/ (메인 서버 코드)
├── agents/ (7개 에이전트 디렉토리)
│   ├── research/ (✅ 완료: 5개 파일)
│   ├── retriever/ (1개 파일)
│   └── 기타 5개 에이전트 (빈 디렉토리)
├── schemas/ (2개 파일)
├── retrieval/ (2개 파일)
├── routers/ (4개 파일)
├── utils/ (7개 파일)
├── workflow/ (6개 파일)
└── main.py

app/ (UI 코드)
├── components/ (2개 파일)
├── utils/ (1개 파일)
└── main.py

tests/ (테스트 코드)
├── agents/ (2개 파일)
├── schemas/ (1개 파일)
├── unit/ (5개 파일)
├── integration/ (2개 파일)
├── e2e/ (2개 파일)
└── performance/ (빈 디렉토리)

config/ (설정 파일)
├── templates/ (빈 디렉토리)
└── environments/ (빈 디렉토리)
```

#### 목표 파일 분포
```
src/ (새로운 소스 코드 구조)
├── agents/ (7개 에이전트)
├── core/ (핵심 기능)
│   ├── schemas/ (공통 스키마)
│   ├── storage/ (저장소)
│   ├── workflow/ (워크플로우)
│   └── utils/ (유틸리티)
├── api/ (REST API)
└── ui/ (Streamlit UI)

tests/ (개선된 테스트 구조)
├── unit/ (단위 테스트)
├── integration/ (통합 테스트)
├── performance/ (성능 테스트)
└── e2e/ (엔드투엔드 테스트)
```

## 마이그레이션 단계별 계획

### Phase 1: 핵심 기능 마이그레이션 (우선순위: 높음)

#### 1.1 스키마 마이그레이션
- **대상**: `server/schemas/` → `src/core/schemas/`
- **파일**: 3개 파일
- **예상 시간**: 30분
- **의존성**: 없음

#### 1.2 저장소 마이그레이션
- **대상**: `server/retrieval/` → `src/core/storage/vector_store/`
- **파일**: 2개 파일
- **예상 시간**: 45분
- **의존성**: 스키마 마이그레이션 완료 후

#### 1.3 유틸리티 마이그레이션
- **대상**: `server/utils/` → `src/core/utils/`
- **파일**: 7개 파일
- **예상 시간**: 1시간
- **의존성**: 저장소 마이그레이션 완료 후

### Phase 2: 에이전트 마이그레이션 (우선순위: 중간)

#### 2.1 Retriever Agent
- **대상**: `server/agents/retriever/` → `src/agents/retriever/`
- **파일**: 2개 파일
- **예상 시간**: 30분
- **의존성**: 핵심 기능 마이그레이션 완료 후

#### 2.2 기타 에이전트 구현 및 마이그레이션
- **대상**: 5개 에이전트 (extractor, wiki, graphviz, supervisor, feedback)
- **파일**: 각 에이전트별 1-3개 파일
- **예상 시간**: 2-3시간
- **의존성**: Retriever Agent 마이그레이션 완료 후

### Phase 3: API 및 UI 마이그레이션 (우선순위: 낮음)

#### 3.1 API 마이그레이션
- **대상**: `server/` → `src/api/`
- **파일**: 10개 파일
- **예상 시간**: 1시간
- **의존성**: 모든 에이전트 마이그레이션 완료 후

#### 3.2 UI 마이그레이션
- **대상**: `app/` → `src/ui/`
- **파일**: 4개 파일
- **예상 시간**: 30분
- **의존성**: API 마이그레이션 완료 후

### Phase 4: 테스트 및 문서 정리 (우선순위: 마지막)

#### 4.1 테스트 구조 개선
- **대상**: 기존 테스트 파일 재배치
- **파일**: 15개 파일
- **예상 시간**: 1시간
- **의존성**: 모든 소스 코드 마이그레이션 완료 후

#### 4.2 문서 정리
- **대상**: 문서 파일 재배치
- **파일**: 5개 파일
- **예상 시간**: 30분
- **의존성**: 테스트 구조 개선 완료 후

## 마이그레이션 위험 요소 및 대응 방안

### 1. Import 경로 변경
**위험**: 모든 import 문을 새로운 경로로 업데이트해야 함
**대응**: 
- 단계별 마이그레이션으로 점진적 변경
- 각 단계마다 테스트 실행으로 검증
- 자동화 스크립트 고려

### 2. 순환 의존성
**위험**: 모듈 간 순환 의존성 발생 가능
**대응**:
- 의존성 그래프 분석
- 공통 기능을 `src/core/`에 배치
- 인터페이스 분리 원칙 적용

### 3. 테스트 실패
**위험**: 마이그레이션 후 테스트 실패 가능
**대응**:
- 각 단계마다 테스트 실행
- 실패 시 즉시 롤백
- 테스트 커버리지 유지

### 4. 성능 저하
**위험**: 마이그레이션 후 성능 저하 가능
**대응**:
- 성능 테스트 실행
- 벤치마크 비교
- 필요시 최적화

## 검증 체크리스트

### 기능 검증
- [ ] 모든 import 경로 정상 동작
- [ ] 테스트 실행 성공 (100% 통과)
- [ ] API 엔드포인트 정상 동작
- [ ] UI 컴포넌트 정상 동작
- [ ] 워크플로우 정상 동작

### 성능 검증
- [ ] 마이그레이션 후 성능 저하 없음
- [ ] 메모리 사용량 정상
- [ ] 응답 시간 유지
- [ ] 캐시 성능 유지

### 문서 검증
- [ ] README 파일 업데이트
- [ ] API 문서 업데이트
- [ ] 마이그레이션 가이드 완성
- [ ] 개발자 가이드 업데이트

## 예상 소요 시간

### 총 예상 시간: 6-8시간
- Phase 1: 2-3시간
- Phase 2: 3-4시간
- Phase 3: 1-2시간
- Phase 4: 1-2시간

### 권장 일정
- **1일차**: Phase 1 (핵심 기능 마이그레이션)
- **2일차**: Phase 2 (에이전트 마이그레이션)
- **3일차**: Phase 3 (API/UI 마이그레이션)
- **4일차**: Phase 4 (테스트/문서 정리)

## 롤백 계획

### 롤백 트리거
- 테스트 실패율 10% 이상
- 성능 저하 20% 이상
- 주요 기능 동작 불가

### 롤백 절차
1. Git 브랜치 생성 (`migration-rollback`)
2. 기존 코드 복원
3. 테스트 실행 및 검증
4. 문제 분석 및 수정
5. 재마이그레이션

## 다음 단계

1. **13.4 기본 import 경로 재설정** 시작
2. **13.5 Research Agent 마이그레이션** 시작
3. **단계별 마이그레이션 실행**

---

**마지막 업데이트**: 2025-01-27
**버전**: 1.0.0